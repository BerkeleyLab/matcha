Workflows
=========

* [Vibe Coding](#vibe-coding)
* [Idiomatic Vibe Coding](#idiomatic-vibe-coding)

Vibe Coding
-----------
1. In a Linux or macOS shell, set your present working directory to Matcha's
   [scripts](../../scripts) directory.   Enter the command
   `./create-single-source-file-programs.sh`, which creates a copy of the
   Matcha test suite and supporting software stack all concatenated into one
   file in the following path relative to the project's root directory:
   "./build/single-file-programs/test-suite.F90".
3. Compile and execute test-suite.F90 to check that the output reports that
   all tests pass.  For example, enter
   ```bash
     gfortran -fcoarray=single -o test-suite test-suite.F90
     ./test-suite
   ```
4. Use the contents of [vibe-coding/README.md](./vibe-coding/README.md) as your
   prompt to a large language model (LLM).
5. Use an editor to edit the test-suite.F90 lines beginning and ending with 
   `module procedure laplacian` and `end procedure laplacian`, respectively,
   replacing those lines with the LLM's response.
6. Compile test-suite.F90 as in step 2 again.
7. If  the test-suite program doesn't compile or if running the compiled
   program doesn't produce output indicating that all tests pass, then start
   over at step 1 but when you reach step 3, edit the prompt as follows:
   * Append the previous iteration's compile-time error message(s) or run-time
     error message(s) or test output.
   * Append the text "Please fix the above errors that were generated by
     compiling the following candidate solution to this prompt:".  If the
     program compiled but runtime errors resulted, replace "compiling" with
     "running" in the previous sentence.  If the program ran without errors,
     but tests failed replace "compiling" with "running" and replace "errors"
     with "test failures".
   * Append LLM-generated code from the previous iteration.
   
Idiomatic Vibe Coding
---------------------
Follow the [vibe coding](#vibe-coding) steps except as described below:
* In your first prompt, attach test-suite.F90 with the lines from
  `module procedure laplacian` to `end procedure laplacian` removed.  If the
  LLM rejects ".F90" file extensions, change the name to "test-suite.txt".
  Appened following to the prompt: "Inserting a correct response to this
  prompt into the subdmodule subdomain_s and then compiling and running the
  attached program must generate output indicating that all tests pass."
* In subsequent iterations, if replacing the laplacian procedure with the
  LLM's most recent response leads to compile-time or runtime errors or if any
  tests fail, update the test-suite program, replacing laplacian with the most
  recent LLM response. Attach the updated program to each prompt.
* In the second bullet of vibe coding step 6, replace the suggested text wit
  "Please fix the above errors that were generated by compiling the attached
  program, which contains an incorrect laplacian procedure."  If the program
  compiled but runtime errors resulted, replace "compiling" with "running" in
  the previous sentence.  If the program ran without errors, but tests failed,
  replace "compiling" with "running" and replace "errors" with "test failures".
* Skip the third bullet in vibe coding step 6 because with idiomatic vibe
  coding, the complete software stack is contained in an attachment.
